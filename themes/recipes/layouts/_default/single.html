{{ define "main" }}
{{ $style := resources.Get "css/single.css" | minify | fingerprint }}
<link rel="stylesheet" href="{{ $style.Permalink }}">
<div class="section">
  <article class="container">
    <header>
      <div class="is-flex">
        {{ with .Params.featured_image }}
        <div class="lightbox-wrapper">
          <input type="checkbox" id="lightbox-toggle" class="lightbox-checkbox" hidden />
          <label for="lightbox-toggle" class="lightbox-trigger">
            <figure class="image is-96x96" style="margin-right: 0.5em;">
              <img alt="{{ $.Title }}" class="is-rounded" src="/images/medium{{ . }}" />
            </figure>
          </label>
          <label for="lightbox-toggle" class="lightbox-overlay">
            <div class="lightbox-content">
              <img alt="{{ $.Title }}" src="/images/large{{ . }}" />
            </div>
          </label>
        </div>
        {{ end }}
        <div>
          <h1 class="title is-1">
            {{ .Title }}
          </h1>
          <h6 class="subtitle is-6">
            {{ .Summary }}
          </h6>
        </div>
      </div>
      <div style="margin-top: 1em;">
        {{ with .Params.Time }}
        <span class="tag is-primary is-light">{{ . }}</span>
        {{ end }}
        {{ with .Params.Output}}
        <span class="tag is-info is-light">{{ . }}</span>
        {{ end }}
        {{ range .Params.Tags }}
        <a class="tag" href="/tags/{{ . }}">{{ . }}</a>
        {{ end }}
      </div>
    </header>

    {{/* Recipe scaling with ingredients from frontmatter */}}
    {{ with .Params.ingredients }}
    <div class="content recipe-content" style="margin-top: 1em;">
      {{/* Hidden radio inputs for CSS-only scale switching */}}
      <input type="radio" name="scale" id="scale-1" checked class="scale-radio">
      <input type="radio" name="scale" id="scale-2" class="scale-radio">
      <input type="radio" name="scale" id="scale-3" class="scale-radio">
      <input type="radio" name="scale" id="scale-4" class="scale-radio">

      {{/* Scale buttons */}}
      <div class="scale-buttons">
        <label for="scale-1" class="scale-btn">1&times;</label>
        <label for="scale-2" class="scale-btn">2&times;</label>
        <label for="scale-3" class="scale-btn">3&times;</label>
        <label for="scale-4" class="scale-btn">4&times;</label>
      </div>

      {{/* Render scaled ingredients */}}
      {{ partial "ingredients.html" $ }}

      {{/* Render directions from content (ingredients removed by migration) */}}
      {{ $.Content | safeHTML }}
    </div>
    {{ else }}
    {{/* Fallback for recipes not yet migrated */}}
    <div class="content" style="margin-top: 1em;">
      <!-- {{ .Content }} -->
      {{ replace .Content "disabled" "enabled" | replaceRE "(<li>)(<input[^>]*?type=\"checkbox\"[^>]*?>)(.*?)(</li>)" "$1<label>$2<span>$3</span></label>$4" | safeHTML }}
    </div>
    {{ end }}
  </article>
</div>
{{ end }}